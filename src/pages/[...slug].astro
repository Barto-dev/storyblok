---
import { useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import generateStaticPaths from '../utils/generateStaticPaths';
import isPreview from '../utils/isPreview';

export async function getStaticPaths() {
  return await generateStaticPaths();
}

const { slug, language, langSwitch } = Astro.props;

const storyblokApi = useStoryblokApi();
const { data } = await storyblokApi.get(`cdn/stories/${slug === undefined ? 'home' : slug}`, {
  version: isPreview() ? 'draft' : 'published',
  resolve_relations: ['popular-articles.articles'],
  language,
});

const story = data.story;
---

<BaseLayout {langSwitch} {language}>
  <StoryblokComponent blok={story.content} {language} />
</BaseLayout>
